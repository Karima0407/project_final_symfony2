{% extends 'base.html.twig' %}

{% block title %}Panier
{% endblock %}

{% block body %}
	<div class="debut_panier">
		<h1 style="margin:40px;color:darkred;">Votre Panier</h1>
		<div class="invisible_panier"></div>
		<button onclick="viderPanier()" class="vider_panier">Vider le Panier</button>
	</div>


	{% if panier is empty %}
		<h2 class="panier_vide">Votre panier est vide...Pensez à
			<a href="{{path('produits_par_categorie', {categoryId: 1})}}" class="panier_vide">continuer vos achats:
			</a>
		</h2>
	{% else %}
		<ul class="ul_panier">
			{% for item in panier %}
				<li class="liste_panier">
					<img src="{{ asset('img/' ~ item.image) }}" alt="{{ item.description }}" width="200" height="200">
					<h4>{{ item.description }}</h4>

					<!-- Prix initial -->
					<h4 class="sousTitres-panier">Prix:<span id="prix{{item.id}}">{{ item.prix }}
							€</span>
					</h4>

					<!-- Ajout du champ de quantité -->
					<label for="quantity{{ item.id }}" class="sousTitres-panier">Quantité:</label>
					<input
					style="width:250px; background-color:pink;" type="number" id="quantity{{ item.id }}" name="quantity{{ item.id }}" min="1" value="1" data-id="{{ item.id }}" class="quantity-input">

					<!-- Mise à jour du prix en fonction de la quantité -->
					<h4 class="sousTitres-panier">Total:
						<span id="total{{ item.id }}">{{ item.prix }}
							€</span>
					</h4>


					<a href="{{ path('supprimer_du_panier', {'id': item.id}) }}" class="supprimer_panier">Supprimer</a>

				</li>
			{% endfor %}
		</ul>
	{% endif %}

	<script>
		// Script JavaScript pour mettre à jour le total en fonction de la quantité
document.addEventListener('DOMContentLoaded', function () {
var quantityInputs = document.querySelectorAll('.quantity-input');

quantityInputs.forEach(function (input) {
input.addEventListener('change', function () {
var itemId = input.getAttribute('data-id');
var itemPrice = parseFloat(document.querySelector('#total' + itemId).innerText);
var prixUnitaire = parseFloat(document.querySelector('#prix' + itemId).innerText);
var quantity = parseInt(input.value);
var total = prixUnitaire * quantity;

// Mettre à jour le total affiché
document.querySelector('#total' + itemId).innerText = total;
});
});
});

// pour vider le panier
function viderPanier() { // Utiliser une requête AJAX pour appeler la route de vidage du panier
$.ajax({
url: '{{ path('vider_panier') }}',
dataType: 'json',
success: function (data) { // Mettre à jour l'affichage du panier ou rediriger vers une autre page si nécessaire
window.location.reload(); // Recharger la page actuelle
},
error: function (jqXHR, status, error) {
console.log('Erreur AJAX', status, error);
}
});
}
	</script>


{% endblock %}
