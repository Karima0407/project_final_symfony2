{% extends 'base.html.twig' %}
{% block title %}{% endblock %}
{% block body %}
	{% set showNav = true %}
	{% include "home/index.html.twig" %}

	<h2 class="phrase_produits">
		{{phrase}}
	</h2>
	<div class="recherche" style="margin-bottom:30px;">
		<input type="text" id="searchInput" placeholder="Tapez votre produit">
		<div id="searchResults"></div>
	</div>
	<div class="listeProduits">
		{% for produit in produits %}
			<div>
				<div>
					<img src="{{ asset('img/' ~ produit.image) }}" alt="{{ produit.description }}" width="400" height="400"></div>
				<h2 style="width:400px;">
					{{ produit.description }}
				</h2>
				{% if produit.category.id == 2 %}
					<div style="">
						<a href='' data-id={{produit.id}} class="ajouter_au_panier">
							Ajouter au Panier
						</a>
						<i class="fa-solid fa-cart-shopping"></i>
					</div>
				{% endif %}
				<a href="{{ path('afficher_produit', {'id': produit.id}) }}" class="voir_detail">
					Voir Plus de détails sur ce produit
				</a>

				{# <input name="qte" type="number" value="1"  id="field{{ produit.id }}">
																																								<button class="btn btn-warning" id="form{{ produit.id }}"													<i class="fa fa-cart-arrow-down"></i>
																																								</button>  #}
			</div>
			{# Mitra #}
			{# <script>
																			window.addEventListener("load", () => {
																			//console.log($("#field{{ produit.id }} [name='qte']").val());
																			//console.log($("#field{{ produit.id }} [name='qte']").val());
																			$("#form{{ produit.id }}").on("click",(evtSubmit) => {
																				evtSubmit.preventDefault();
																				$.ajax({
																					url: "{{ path('ajout_panier', {id: produit.id}) }}",
																					data: "qte=" + 1,
																					type: 'POST',
																					dataType: "json",
																					success: (data) => {
																						$("#nombre").html(data);
																						console.log("nb produits dans le panier = " + data);
																					},
																					error: (jqXHR,status, error) => {
																						console.log("ERREUR AJAX" , status,error);
																					}
																				});
																				});
																				});
																		</script> #}
		{% endfor %}
		{% if produits.hasPreviousPage %}
			<a href="{{ path('produits_par_categorie', {'categoryId': categoryId,'page': produits.previousPage}) }}" class="pagination">Précédent</a>
		{% endif %}
		{% if produits.hasNextPage %}
			<a href="{{ path('produits_par_categorie', {'categoryId': categoryId,'page': produits.nextPage}) }}" class="pagination">Suivant</a>
		{% endif %}

	</div>
	<script>
		document.addEventListener("DOMContentLoaded", function () {
var recherche = document.getElementById("searchInput");
var articles = document.querySelectorAll(".listeProduits div");

recherche.addEventListener("input", function () {
var searchTerm = recherche.value.toLowerCase();

articles.forEach(function (article) {
var articleName = article.querySelector("h2").textContent.toLowerCase();
// Vérifiez si le terme de recherche est inclus dans le titre de l'article
if (articleName.includes(searchTerm)) {
article.style.display = "block";
} else {
article.style.display = "none";
}
});
});
});
	</script>
{% endblock %}
{% block javascripts %}{% endblock %}
